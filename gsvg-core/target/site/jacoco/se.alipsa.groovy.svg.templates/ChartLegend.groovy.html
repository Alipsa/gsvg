<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ChartLegend.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gsvg</a> &gt; <a href="index.source.html" class="el_package">se.alipsa.groovy.svg.templates</a> &gt; <span class="el_source">ChartLegend.groovy</span></div><h1>ChartLegend.groovy</h1><pre class="source lang-java linenums">package se.alipsa.groovy.svg.templates

import groovy.transform.CompileStatic
import se.alipsa.groovy.svg.*

/**
 * Template for creating chart legends.
 * &lt;p&gt;
 * This template creates a legend box with color swatches and labels for chart data.
 * It's commonly used with bar charts, pie charts, and line graphs.
 * &lt;p&gt;
 * &lt;h2&gt;Parameters:&lt;/h2&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;&lt;b&gt;x&lt;/b&gt; - X coordinate of legend box (default: 0)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;y&lt;/b&gt; - Y coordinate of legend box (default: 0)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;items&lt;/b&gt; - List of legend items, each with 'color' and 'label' (required)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;swatchSize&lt;/b&gt; - Size of color swatches (default: 15)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;spacing&lt;/b&gt; - Vertical spacing between items (default: 25)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;fontSize&lt;/b&gt; - Font size for labels (default: 14)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;padding&lt;/b&gt; - Padding inside legend box (default: 10)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;showBorder&lt;/b&gt; - Whether to show border around legend (default: true)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;borderColor&lt;/b&gt; - Border color (default: 'black')&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;borderWidth&lt;/b&gt; - Border width (default: 1)&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;backgroundColor&lt;/b&gt; - Background color (default: 'white')&lt;/li&gt;
 *   &lt;li&gt;&lt;b&gt;backgroundOpacity&lt;/b&gt; - Background opacity 0-1 (default: 0.9)&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;p&gt;
 * &lt;h2&gt;Usage Example:&lt;/h2&gt;
 * &lt;pre&gt;
 * Svg svg = new Svg(600, 400)
 *
 * // Create chart data
 * def chartData = [
 *     [color: 'red', label: 'Product A'],
 *     [color: 'blue', label: 'Product B'],
 *     [color: 'green', label: 'Product C']
 * ]
 *
 * // Add legend
 * ChartLegend legend = new ChartLegend()
 * legend.apply(svg, [
 *     x: 450,
 *     y: 50,
 *     items: chartData
 * ])
 * &lt;/pre&gt;
 *
 * @since 0.9.0
 */
@CompileStatic
class ChartLegend extends Template {

    @Override
    SvgElement apply(AbstractElementContainer parent, Map params) {
<span class="fc" id="L55">        Map merged = mergeParams(params)</span>

<span class="fc" id="L57">        Number x = merged.x as Number</span>
<span class="fc" id="L58">        Number y = merged.y as Number</span>
<span class="fc" id="L59">        List&lt;Map&gt; items = merged.items as List&lt;Map&gt;</span>
<span class="fc" id="L60">        Number swatchSize = merged.swatchSize as Number</span>
<span class="fc" id="L61">        Number spacing = merged.spacing as Number</span>
<span class="fc" id="L62">        Number fontSize = merged.fontSize as Number</span>
<span class="fc" id="L63">        Number padding = merged.padding as Number</span>
<span class="fc" id="L64">        boolean showBorder = merged.showBorder as boolean</span>
<span class="fc" id="L65">        String borderColor = merged.borderColor as String</span>
<span class="fc" id="L66">        Number borderWidth = merged.borderWidth as Number</span>
<span class="fc" id="L67">        String backgroundColor = merged.backgroundColor as String</span>
<span class="fc" id="L68">        Number backgroundOpacity = merged.backgroundOpacity as Number</span>

        // Create group for legend
<span class="fc" id="L71">        G legendGroup = parent.addG()</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">        legendGroup.id(merged.id as String ?: null)</span>

        // Calculate dimensions
<span class="fc" id="L75">        int maxLabelWidth = 150  // Estimate - could be made configurable</span>
<span class="fc" id="L76">        int legendWidth = (padding.intValue() * 2) + swatchSize.intValue() + 10 + maxLabelWidth</span>
<span class="fc" id="L77">        int legendHeight = (padding.intValue() * 2) + (items.size() * spacing.intValue())</span>

        // Background
<span class="fc" id="L80">        Rect background = legendGroup.addRect()</span>
<span class="fc" id="L81">        background.x(x).y(y)</span>
                  .width(legendWidth)
                  .height(legendHeight)
                  .fill(backgroundColor)
                  .fillOpacity(backgroundOpacity)

        // Border
<span class="fc bfc" id="L88" title="All 2 branches covered.">        if (showBorder) {</span>
<span class="fc" id="L89">            background.stroke(borderColor)</span>
                      .strokeWidth(borderWidth)
        } else {
<span class="fc" id="L92">            background.stroke('none')</span>
        }

        // Add legend items
<span class="fc" id="L96">        items.eachWithIndex { Map item, int index -&gt;</span>
<span class="fc" id="L97">            int itemY = y.intValue() + padding.intValue() + (index * spacing.intValue())</span>
<span class="fc" id="L98">            int itemX = x.intValue() + padding.intValue()</span>

            // Color swatch
<span class="fc" id="L101">            legendGroup.addRect()</span>
                .x(itemX)
                .y(itemY)
                .width(swatchSize)
                .height(swatchSize)
                .fill(item.color as String)
                .stroke('black')
                .strokeWidth(1)

            // Label
<span class="fc" id="L111">            legendGroup.addText(item.label as String)</span>
<span class="fc" id="L112">                .x(itemX + swatchSize.intValue() + 10)</span>
<span class="fc" id="L113">                .y(itemY + (swatchSize.intValue() / 2) + 5)</span>
                .fontSize(fontSize)
                .fill('black')
        }

<span class="fc" id="L118">        return legendGroup</span>
    }

    @Override
    Map getDefaults() {
<span class="fc" id="L123">        return [</span>
            x: 0,
            y: 0,
<span class="fc" id="L126">            items: [],</span>
            swatchSize: 15,
            spacing: 25,
            fontSize: 14,
            padding: 10,
            showBorder: true,
            borderColor: 'black',
            borderWidth: 1,
            backgroundColor: 'white',
            backgroundOpacity: 0.9,
            id: null
        ]
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>