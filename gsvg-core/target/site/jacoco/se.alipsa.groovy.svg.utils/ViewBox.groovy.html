<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ViewBox.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gsvg</a> &gt; <a href="index.source.html" class="el_package">se.alipsa.groovy.svg.utils</a> &gt; <span class="el_source">ViewBox.groovy</span></div><h1>ViewBox.groovy</h1><pre class="source lang-java linenums">package se.alipsa.groovy.svg.utils

import groovy.transform.CompileStatic
import groovy.transform.Immutable

/**
 * Represents an SVG viewBox attribute with helper methods for manipulation and conversion.
 * &lt;p&gt;
 * The viewBox attribute defines the coordinate system and aspect ratio for an SVG element.
 * It consists of four values: minX, minY, width, and height.
 * &lt;/p&gt;
 *
 * &lt;p&gt;Example usage:&lt;/p&gt;
 * &lt;pre&gt;
 * // Create a viewBox
 * def vb = ViewBox.of(0, 0, 100, 100)
 *
 * // Parse from string
 * def parsed = ViewBox.parse(&quot;0 0 200 200&quot;)
 *
 * // Transform it
 * def scaled = vb.scale(2.0)        // 0 0 200 200
 * def translated = vb.translate(10, 10)  // 10 10 100 100
 *
 * // Use with SVG
 * svg.viewBox(vb.toString())
 * // or with convenience method:
 * svg.viewBox(vb)
 * &lt;/pre&gt;
 */
@CompileStatic
@Immutable
class ViewBox {

  /**
   * The minimum x coordinate of the viewport
   */
  double minX

  /**
   * The minimum y coordinate of the viewport
   */
  double minY

  /**
   * The width of the viewport
   */
  double width

  /**
   * The height of the viewport
   */
  double height

  // ==================== STATIC FACTORY METHODS ====================

  /**
   * Create a ViewBox with the specified coordinates and dimensions
   * @param minX the minimum x coordinate
   * @param minY the minimum y coordinate
   * @param width the viewport width (must be positive)
   * @param height the viewport height (must be positive)
   * @return a new ViewBox
   * @throws IllegalArgumentException if width or height is not positive
   */
  static ViewBox of(Number minX, Number minY, Number width, Number height) {
<span class="fc" id="L67">    double w = width.doubleValue()</span>
<span class="fc" id="L68">    double h = height.doubleValue()</span>

<span class="fc bfc" id="L70" title="All 4 branches covered.">    if (w &lt;= 0) {</span>
<span class="fc" id="L71">      throw new IllegalArgumentException(&quot;ViewBox width must be positive, got: ${w}&quot;)</span>
    }
<span class="fc bfc" id="L73" title="All 4 branches covered.">    if (h &lt;= 0) {</span>
<span class="fc" id="L74">      throw new IllegalArgumentException(&quot;ViewBox height must be positive, got: ${h}&quot;)</span>
    }

<span class="fc" id="L77">    new ViewBox(minX.doubleValue(), minY.doubleValue(), w, h)</span>
  }

  /**
   * Parse a viewBox string (e.g., &quot;0 0 100 100&quot; or &quot;0,0,100,100&quot;)
   * @param viewBoxString the viewBox string to parse
   * @return a new ViewBox
   * @throws IllegalArgumentException if the string is invalid
   */
  static ViewBox parse(String viewBoxString) {
<span class="fc bfc" id="L87" title="All 8 branches covered.">    if (viewBoxString == null || viewBoxString.trim().isEmpty()) {</span>
<span class="fc" id="L88">      throw new IllegalArgumentException(&quot;ViewBox string cannot be null or empty&quot;)</span>
    }

    // Split by whitespace or commas
<span class="fc" id="L92">    String[] parts = viewBoxString.trim().split(/[\s,]+/)</span>

<span class="fc bfc" id="L94" title="All 4 branches covered.">    if (parts.length != 4) {</span>
<span class="fc" id="L95">      throw new IllegalArgumentException(&quot;ViewBox string must contain exactly 4 values, got: ${viewBoxString}&quot;)</span>
    }

    try {
<span class="fc" id="L99">      double minX = Double.parseDouble(parts[0])</span>
<span class="fc" id="L100">      double minY = Double.parseDouble(parts[1])</span>
<span class="fc" id="L101">      double width = Double.parseDouble(parts[2])</span>
<span class="fc" id="L102">      double height = Double.parseDouble(parts[3])</span>

<span class="pc" id="L104">      return of(minX, minY, width, height)</span>
    } catch (NumberFormatException e) {
<span class="nc" id="L106">      throw new IllegalArgumentException(&quot;Invalid ViewBox string: ${viewBoxString}&quot;, e)</span>
    }
  }

  // ==================== TRANSFORMATION METHODS ====================

  /**
   * Scale the viewBox dimensions by a factor.
   * The minX and minY coordinates are preserved.
   * @param factor the scale factor (must be positive)
   * @return a new ViewBox with scaled dimensions
   * @throws IllegalArgumentException if factor is not positive
   */
  ViewBox scale(Number factor) {
<span class="fc" id="L120">    double f = factor.doubleValue()</span>
<span class="fc bfc" id="L121" title="All 4 branches covered.">    if (f &lt;= 0) {</span>
<span class="fc" id="L122">      throw new IllegalArgumentException(&quot;Scale factor must be positive, got: ${f}&quot;)</span>
    }
<span class="fc" id="L124">    new ViewBox(minX, minY, width * f, height * f)</span>
  }

  /**
   * Scale the viewBox dimensions by separate x and y factors.
   * The minX and minY coordinates are preserved.
   * @param scaleX the x-axis scale factor (must be positive)
   * @param scaleY the y-axis scale factor (must be positive)
   * @return a new ViewBox with scaled dimensions
   * @throws IllegalArgumentException if either factor is not positive
   */
  ViewBox scale(Number scaleX, Number scaleY) {
<span class="fc" id="L136">    double sx = scaleX.doubleValue()</span>
<span class="fc" id="L137">    double sy = scaleY.doubleValue()</span>
<span class="pc bpc" id="L138" title="5 of 10 branches missed.">    if (sx &lt;= 0 || sy &lt;= 0) {</span>
<span class="nc" id="L139">      throw new IllegalArgumentException(&quot;Scale factors must be positive, got: (${sx}, ${sy})&quot;)</span>
    }
<span class="fc" id="L141">    new ViewBox(minX, minY, width * sx, height * sy)</span>
  }

  /**
   * Translate (shift) the viewBox by the given offsets.
   * The width and height are preserved.
   * @param dx the x offset
   * @param dy the y offset
   * @return a new ViewBox with translated coordinates
   */
  ViewBox translate(Number dx, Number dy) {
<span class="fc" id="L152">    new ViewBox(minX + dx.doubleValue(), minY + dy.doubleValue(), width, height)</span>
  }

  /**
   * Expand the viewBox by adding margins on all sides.
   * @param margin the margin to add (can be negative to shrink)
   * @return a new ViewBox expanded by the margin
   * @throws IllegalArgumentException if the resulting width or height would be non-positive
   */
  ViewBox expand(Number margin) {
<span class="fc" id="L162">    double m = margin.doubleValue()</span>
<span class="fc" id="L163">    return expand(m, m, m, m)</span>
  }

  /**
   * Expand the viewBox by adding different margins on each side.
   * @param top margin to add to the top (negative minY direction)
   * @param right margin to add to the right (positive width direction)
   * @param bottom margin to add to the bottom (positive height direction)
   * @param left margin to add to the left (negative minX direction)
   * @return a new ViewBox with expanded dimensions
   * @throws IllegalArgumentException if the resulting width or height would be non-positive
   */
  ViewBox expand(Number top, Number right, Number bottom, Number left) {
<span class="fc" id="L176">    double t = top.doubleValue()</span>
<span class="fc" id="L177">    double r = right.doubleValue()</span>
<span class="fc" id="L178">    double b = bottom.doubleValue()</span>
<span class="fc" id="L179">    double l = left.doubleValue()</span>

<span class="fc" id="L181">    double newMinX = minX - l</span>
<span class="fc" id="L182">    double newMinY = minY - t</span>
<span class="fc" id="L183">    double newWidth = width + l + r</span>
<span class="fc" id="L184">    double newHeight = height + t + b</span>

<span class="fc" id="L186">    return of(newMinX, newMinY, newWidth, newHeight)</span>
  }

  /**
   * Center the viewBox at a specific point while maintaining its dimensions.
   * @param centerX the new center x coordinate
   * @param centerY the new center y coordinate
   * @return a new ViewBox centered at the specified point
   */
  ViewBox centerAt(Number centerX, Number centerY) {
<span class="fc" id="L196">    double cx = centerX.doubleValue()</span>
<span class="fc" id="L197">    double cy = centerY.doubleValue()</span>
<span class="fc" id="L198">    double newMinX = cx - (width / 2.0)</span>
<span class="fc" id="L199">    double newMinY = cy - (height / 2.0)</span>
<span class="fc" id="L200">    new ViewBox(newMinX, newMinY, width, height)</span>
  }

  /**
   * Set a specific aspect ratio for the viewBox by adjusting the height.
   * The width is preserved.
   * @param ratio the desired width/height ratio (must be positive)
   * @return a new ViewBox with the specified aspect ratio
   * @throws IllegalArgumentException if ratio is not positive
   */
  ViewBox withAspectRatio(Number ratio) {
<span class="fc" id="L211">    double r = ratio.doubleValue()</span>
<span class="fc bfc" id="L212" title="All 4 branches covered.">    if (r &lt;= 0) {</span>
<span class="fc" id="L213">      throw new IllegalArgumentException(&quot;Aspect ratio must be positive, got: ${r}&quot;)</span>
    }
<span class="fc" id="L215">    double newHeight = width / r</span>
<span class="fc" id="L216">    new ViewBox(minX, minY, width, newHeight)</span>
  }

  /**
   * Scale and center another viewBox to fit inside this viewBox.
   * &lt;p&gt;
   * When {@code preserveAspectRatio} is true (default), 'other' is uniformly scaled to fit
   * inside this viewBox while maintaining its aspect ratio, then centered.
   * &lt;/p&gt;
   * &lt;p&gt;
   * When {@code preserveAspectRatio} is false, 'other' is scaled non-uniformly to exactly
   * fill this viewBox. The returned ViewBox has this viewBox's position and dimensions,
   * representing where 'other' would appear after being stretched/squashed to fill.
   * &lt;/p&gt;
   *
   * @param other the viewBox to scale and fit inside this one
   * @param preserveAspectRatio whether to preserve aspect ratio (if false, scales to fill)
   * @return a new ViewBox representing the fitted result
   */
  ViewBox fitToContain(ViewBox other, boolean preserveAspectRatio = true) {
<span class="fc bfc" id="L236" title="All 4 branches covered.">    if (!preserveAspectRatio) {</span>
      // Scale to fill without preserving aspect ratio
      // Result represents 'other' stretched to exactly match this viewBox's dimensions
<span class="fc" id="L239">      return new ViewBox(minX, minY, width, height)</span>
    }

    // Calculate scale factor that fits 'other' inside 'this' while preserving aspect ratio
<span class="fc" id="L243">    Number scaleX = width / other.width</span>
<span class="fc" id="L244">    Number scaleY = height / other.height</span>
<span class="fc" id="L245">    Number scale = Math.min(scaleX.doubleValue(), scaleY.doubleValue())</span>

<span class="fc" id="L247">    Number newWidth = other.width * scale.doubleValue()</span>
<span class="fc" id="L248">    Number newHeight = other.height * scale.doubleValue()</span>

    // Center the fitted viewBox within this viewBox's bounds
<span class="fc" id="L251">    Number newMinX = minX + (width - newWidth.doubleValue()) / 2.0</span>
<span class="fc" id="L252">    Number newMinY = minY + (height - newHeight.doubleValue()) / 2.0</span>

<span class="fc" id="L254">    new ViewBox(newMinX.doubleValue(), newMinY.doubleValue(), newWidth.doubleValue(), newHeight.doubleValue())</span>
  }

  // ==================== QUERY METHODS ====================

  /**
   * Get the center x coordinate of the viewBox
   * @return the center x coordinate
   */
  double getCenterX() {
<span class="fc" id="L264">    minX + (width / 2.0)</span>
  }

  /**
   * Get the center y coordinate of the viewBox
   * @return the center y coordinate
   */
  double getCenterY() {
<span class="fc" id="L272">    minY + (height / 2.0)</span>
  }

  /**
   * Get the maximum x coordinate of the viewBox
   * @return the maximum x coordinate
   */
  double getMaxX() {
<span class="fc" id="L280">    minX + width</span>
  }

  /**
   * Get the maximum y coordinate of the viewBox
   * @return the maximum y coordinate
   */
  double getMaxY() {
<span class="fc" id="L288">    minY + height</span>
  }

  /**
   * Get the aspect ratio (width / height) of the viewBox
   * @return the aspect ratio
   */
  double getAspectRatio() {
<span class="fc" id="L296">    width / height</span>
  }

  /**
   * Check if a point is contained within this viewBox.
   * Uses inclusive bounds on all edges for consistency with SVG rendering behavior.
   * @param x the x coordinate
   * @param y the y coordinate
   * @return true if the point is inside or on the boundary of the viewBox
   */
  boolean contains(Number x, Number y) {
<span class="fc" id="L307">    double px = x.doubleValue()</span>
<span class="fc" id="L308">    double py = y.doubleValue()</span>
<span class="pc bpc" id="L309" title="4 of 20 branches missed.">    px &gt;= minX &amp;&amp; px &lt;= maxX &amp;&amp; py &gt;= minY &amp;&amp; py &lt;= maxY</span>
  }

  /**
   * Check if another viewBox is entirely contained within this one
   * @param other the other viewBox
   * @return true if the other viewBox is entirely inside this one
   */
  boolean contains(ViewBox other) {
<span class="fc bfc" id="L318" title="All 10 branches covered.">    other.minX &gt;= minX &amp;&amp; other.maxX &lt;= maxX &amp;&amp;</span>
<span class="pc bpc" id="L319" title="4 of 10 branches missed.">    other.minY &gt;= minY &amp;&amp; other.maxY &lt;= maxY</span>
  }

  /**
   * Check if this viewBox intersects with another viewBox
   * @param other the other viewBox
   * @return true if the viewBoxes intersect
   */
  boolean intersects(ViewBox other) {
<span class="fc bfc" id="L328" title="All 10 branches covered.">    !(other.maxX &lt; minX || other.minX &gt; maxX ||</span>
<span class="pc bpc" id="L329" title="4 of 12 branches missed.">      other.maxY &lt; minY || other.minY &gt; maxY)</span>
  }

  // ==================== OUTPUT METHODS ====================

  /**
   * Convert to SVG viewBox attribute string (space-separated values)
   * @return the viewBox string (e.g., &quot;0 0 100 100&quot;)
   */
  @Override
  String toString() {
<span class="fc" id="L340">    &quot;${formatNumber(minX)} ${formatNumber(minY)} ${formatNumber(width)} ${formatNumber(height)}&quot;</span>
  }

  /**
   * Format a number nicely - removes unnecessary decimals and trailing zeros.
   * &lt;p&gt;
   * Delegates to {@link NumberFormatter} for consistent formatting across the library.
   *
   * @param n the number to format
   * @return formatted string
   */
  private static String formatNumber(double n) {
<span class="fc" id="L352">    NumberFormatter.format(n)</span>
  }

  /**
   * Convert to a map representation
   * @return a map with keys: minX, minY, width, height
   */
  Map&lt;String, Double&gt; toMap() {
<span class="fc" id="L360">    [minX: minX, minY: minY, width: width, height: height]</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>