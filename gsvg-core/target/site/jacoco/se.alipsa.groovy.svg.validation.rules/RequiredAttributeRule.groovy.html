<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RequiredAttributeRule.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gsvg</a> &gt; <a href="index.source.html" class="el_package">se.alipsa.groovy.svg.validation.rules</a> &gt; <span class="el_source">RequiredAttributeRule.groovy</span></div><h1>RequiredAttributeRule.groovy</h1><pre class="source lang-java linenums">package se.alipsa.groovy.svg.validation.rules

import groovy.transform.CompileStatic
import se.alipsa.groovy.svg.SvgElement
import se.alipsa.groovy.svg.validation.ValidationIssue
import se.alipsa.groovy.svg.validation.ValidationReport
import se.alipsa.groovy.svg.validation.ValidationRule

/**
 * Validates that elements have their required attributes according to the SVG specification.
 * &lt;p&gt;
 * Different SVG elements have different required attributes. For example:
 * &lt;ul&gt;
 *   &lt;li&gt;circle requires: cx, cy, r&lt;/li&gt;
 *   &lt;li&gt;rect requires: (none strictly required, but width/height recommended)&lt;/li&gt;
 *   &lt;li&gt;line requires: x1, y1, x2, y2&lt;/li&gt;
 *   &lt;li&gt;use requires: href or xlink:href&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;p&gt;
 * This rule uses a permissive approach - only truly required attributes generate errors.
 * Missing recommended attributes generate warnings.
 */
@CompileStatic
class RequiredAttributeRule implements ValidationRule {
    private static final String RULE_ID = &quot;REQUIRED_ATTR&quot;

    // Required attributes per element type
    private static final Map&lt;String, List&lt;String&gt;&gt; REQUIRED_ATTRS = [
<span class="fc" id="L29">        'circle': ['cx', 'cy', 'r'],</span>
<span class="fc" id="L30">        'ellipse': ['cx', 'cy', 'rx', 'ry'],</span>
<span class="fc" id="L31">        'line': ['x1', 'y1', 'x2', 'y2'],</span>
<span class="fc" id="L32">        'image': ['href'],  // or xlink:href</span>
<span class="fc" id="L33">        'use': ['href'],    // or xlink:href</span>
    ]

    // Recommended attributes (warnings, not errors)
    private static final Map&lt;String, List&lt;String&gt;&gt; RECOMMENDED_ATTRS = [
<span class="fc" id="L38">        'rect': ['width', 'height'],</span>
<span class="fc" id="L39">        'svg': ['width', 'height'],</span>
    ]

    @Override
    String getRuleId() {
<span class="fc" id="L44">        RULE_ID</span>
    }

    @Override
    String getDescription() {
<span class="nc" id="L49">        &quot;Validates that elements have required attributes&quot;</span>
    }

    @Override
    void validate(SvgElement element, ValidationReport report) {
<span class="fc bfc" id="L54" title="All 6 branches covered.">        if (!element) {</span>
<span class="fc" id="L55">            return</span>
        }

<span class="fc" id="L58">        String elementName = element.name</span>

        // Check required attributes
<span class="fc" id="L61">        List&lt;String&gt; requiredAttrs = REQUIRED_ATTRS[elementName]</span>
<span class="fc bfc" id="L62" title="All 4 branches covered.">        if (requiredAttrs) {</span>
<span class="fc" id="L63">            requiredAttrs.each { attrName -&gt;</span>
<span class="fc" id="L64">                String value = element.getAttribute(attrName)</span>

                // Special handling for href (can be href or xlink:href)
<span class="fc bfc" id="L67" title="All 2 branches covered.">                if (attrName == 'href') {</span>
<span class="fc" id="L68">                    String xlinkHref = null</span>
                    try {
<span class="pc" id="L70">                        xlinkHref = element.getAttribute('xlink:href')</span>
                    } catch (IllegalArgumentException e) {
                        // xlink namespace not bound, ignore
                    }
<span class="pc bpc" id="L74" title="3 of 14 branches missed.">                    if (!value &amp;&amp; !xlinkHref) {</span>
<span class="fc" id="L75">                        report.addIssue(ValidationIssue.error(</span>
                            &quot;Missing required attribute '${attrName}' (or 'xlink:href')&quot;,
<span class="fc" id="L77">                            getElementPath(element),</span>
                            element,
                            RULE_ID
                        ))
                    }
<span class="pc bpc" id="L82" title="1 of 10 branches missed.">                } else if (!value || value.trim().isEmpty()) {</span>
<span class="fc" id="L83">                    report.addIssue(ValidationIssue.error(</span>
                        &quot;Missing required attribute '${attrName}'&quot;,
<span class="fc" id="L85">                        getElementPath(element),</span>
                        element,
                        RULE_ID
                    ))
                }
<span class="fc" id="L90">            }</span>
        }

        // Check recommended attributes
<span class="fc" id="L94">        List&lt;String&gt; recommendedAttrs = RECOMMENDED_ATTRS[elementName]</span>
<span class="fc bfc" id="L95" title="All 4 branches covered.">        if (recommendedAttrs) {</span>
<span class="fc" id="L96">            recommendedAttrs.each { attrName -&gt;</span>
<span class="fc" id="L97">                String value = element.getAttribute(attrName)</span>
<span class="pc bpc" id="L98" title="1 of 10 branches missed.">                if (!value || value.trim().isEmpty()) {</span>
<span class="fc" id="L99">                    report.addIssue(ValidationIssue.warning(</span>
                        &quot;Missing recommended attribute '${attrName}'&quot;,
<span class="fc" id="L101">                        getElementPath(element),</span>
                        element,
                        RULE_ID
                    ))
                }
<span class="fc" id="L106">            }</span>
        }
<span class="fc" id="L108">    }</span>

    private String getElementPath(SvgElement element) {
<span class="fc" id="L111">        String id = element.id</span>
<span class="fc" id="L112">        String name = element.name</span>
<span class="pc bpc" id="L113" title="2 of 4 branches missed.">        id ? &quot;${name}#${id}&quot; : name</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>