<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Effects.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gsvg</a> &gt; <a href="index.source.html" class="el_package">se.alipsa.groovy.svg.effects</a> &gt; <span class="el_source">Effects.groovy</span></div><h1>Effects.groovy</h1><pre class="source lang-java linenums">package se.alipsa.groovy.svg.effects

import groovy.transform.CompileStatic
import se.alipsa.groovy.svg.*

/**
 * Provides preset filter effects for common visual effects.
 * &lt;p&gt;
 * This utility class offers factory methods for creating commonly used SVG filter effects
 * such as drop shadows, glows, blurs, and color transformations. Each method returns a
 * configured {@link Filter} that can be added to an SVG's {@code &lt;defs&gt;} section.
 * &lt;p&gt;
 * &lt;h2&gt;Usage Examples:&lt;/h2&gt;
 * &lt;pre&gt;
 * // Create a drop shadow effect
 * Svg svg = new Svg(200, 200)
 * Filter shadow = Effects.dropShadow(svg.addDefs(), id: 'shadow1', dx: 2, dy: 2, blur: 3)
 * svg.addCircle().cx(100).cy(100).r(50).filter('url(#shadow1)')
 *
 * // Create a glow effect
 * Filter glow = Effects.glow(svg.addDefs(), id: 'glow1', color: 'yellow', strength: 2)
 * svg.addText('Glowing!').x(50).y(100).filter('url(#glow1)')
 *
 * // Create a blur effect
 * Filter blur = Effects.blur(svg.addDefs(), 5.0, 'blur1')
 * svg.addRect().width(100).height(100).filter('url(#blur1)')
 * &lt;/pre&gt;
 *
 * @since 0.9.0
 */
@CompileStatic
class Effects {

    /**
     * Creates a drop shadow filter effect.
     * &lt;p&gt;
     * Adds a realistic drop shadow behind an element using feDropShadow or
     * a combination of feGaussianBlur, feOffset, and feMerge for wider compatibility.
     * &lt;p&gt;
     * Options:
     * &lt;ul&gt;
     *   &lt;li&gt;id - Filter ID (default: 'dropShadow')&lt;/li&gt;
     *   &lt;li&gt;dx - Horizontal offset in pixels (default: 2)&lt;/li&gt;
     *   &lt;li&gt;dy - Vertical offset in pixels (default: 2)&lt;/li&gt;
     *   &lt;li&gt;blur - Blur radius (stdDeviation) (default: 3)&lt;/li&gt;
     *   &lt;li&gt;opacity - Shadow opacity 0-1 (default: 0.5)&lt;/li&gt;
     *   &lt;li&gt;color - Shadow color (default: 'black')&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param parent parent element (typically a Defs)
     * @param options optional configuration map
     * @return configured Filter
     */
    static Filter dropShadow(AbstractElementContainer parent, Map options = [:]) {
<span class="nc bnc" id="L55" title="All 2 branches missed.">        String id = options.id ?: 'dropShadow'</span>
<span class="nc bnc" id="L56" title="All 4 branches missed.">        Number dx = options.dx != null ? options.dx as Number : 2</span>
<span class="nc bnc" id="L57" title="All 4 branches missed.">        Number dy = options.dy != null ? options.dy as Number : 2</span>
<span class="nc bnc" id="L58" title="All 4 branches missed.">        Number blur = options.blur != null ? options.blur as Number : 3</span>
<span class="nc bnc" id="L59" title="All 4 branches missed.">        Number opacity = options.opacity != null ? options.opacity as Number : 0.5</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        String color = options.color ?: 'black'</span>

<span class="nc" id="L62">        Filter filter = parent.addFilter(id)</span>

        // Use feDropShadow for modern browsers (simpler)
<span class="nc" id="L65">        filter.addFeDropShadow()</span>
            .dx(dx)
            .dy(dy)
            .stdDeviation(blur)
            .floodOpacity(opacity)
            .floodColor(color)

<span class="nc" id="L72">        filter</span>
    }

    /**
     * Creates a glow/halo effect around an element.
     * &lt;p&gt;
     * Uses feGaussianBlur and feComposite to create a colored glow effect.
     * &lt;p&gt;
     * Options:
     * &lt;ul&gt;
     *   &lt;li&gt;id - Filter ID (default: 'glow')&lt;/li&gt;
     *   &lt;li&gt;color - Glow color (default: 'yellow')&lt;/li&gt;
     *   &lt;li&gt;blur - Blur radius (default: 4)&lt;/li&gt;
     *   &lt;li&gt;strength - Intensity multiplier 1-5 (default: 2)&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param parent parent element (typically a Defs)
     * @param options optional configuration map
     * @return configured Filter
     */
    static Filter glow(AbstractElementContainer parent, Map options = [:]) {
<span class="nc bnc" id="L93" title="All 2 branches missed.">        String id = options.id ?: 'glow'</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">        String color = options.color ?: 'yellow'</span>
<span class="nc bnc" id="L95" title="All 4 branches missed.">        Number blur = options.blur != null ? options.blur as Number : 4</span>
<span class="nc bnc" id="L96" title="All 4 branches missed.">        Number strength = options.strength != null ? options.strength as Number : 2</span>

<span class="nc" id="L98">        Filter filter = parent.addFilter(id)</span>

        // Create colored flood
<span class="nc" id="L101">        filter.addFeFlood()</span>
            .floodColor(color)
            .result('flood')

        // Composite with source alpha to get the shape
<span class="nc" id="L106">        filter.addFeComposite()</span>
            .in('flood')
            .in2('SourceAlpha')
            .operator('in')
            .result('coloredAlpha')

        // Blur the colored shape
<span class="nc" id="L113">        filter.addFeGaussianBlur()</span>
            .in('coloredAlpha')
            .stdDeviation(blur)
            .result('blurred')

        // Merge the glow with the original
<span class="nc" id="L119">        FeMerge merge = filter.addFeMerge()</span>
        // Optionally add multiple glow layers for strength
<span class="nc" id="L121">        int layers = Math.min(5, Math.max(1, strength.intValue()))</span>
<span class="nc" id="L122">        layers.times {</span>
<span class="nc" id="L123">            merge.addFeMergeNode().in('blurred')</span>
        }
<span class="nc" id="L125">        merge.addFeMergeNode().in('SourceGraphic')</span>

<span class="nc" id="L127">        filter</span>
    }

    /**
     * Creates a simple Gaussian blur filter.
     * &lt;p&gt;
     * Applies uniform blur to the element.
     *
     * @param parent parent element (typically a Defs)
     * @param blur blur radius (stdDeviation), default 4.0
     * @param id filter ID, default 'blur'
     * @return configured Filter
     */
    static Filter blur(AbstractElementContainer parent, double blur = 4.0, String id = 'blur') {
<span class="nc" id="L141">        Filter filter = parent.addFilter(id)</span>
<span class="nc" id="L142">        filter.addFeGaussianBlur()</span>
            .in('SourceGraphic')
            .stdDeviation(blur)
<span class="nc" id="L145">        filter</span>
    }

    /**
     * Creates a grayscale (desaturation) filter.
     * &lt;p&gt;
     * Converts the element to grayscale using feColorMatrix.
     *
     * @param parent parent element (typically a Defs)
     * @param id filter ID, default 'grayscale'
     * @return configured Filter
     */
    static Filter grayscale(AbstractElementContainer parent, String id = 'grayscale') {
<span class="nc" id="L158">        Filter filter = parent.addFilter(id)</span>
<span class="nc" id="L159">        filter.addFeColorMatrix()</span>
            .type('saturate')
            .values('0')  // 0 = fully desaturated (grayscale)
<span class="nc" id="L162">        filter</span>
    }

    /**
     * Creates a sepia tone filter.
     * &lt;p&gt;
     * Applies a warm, vintage sepia tone effect using feColorMatrix.
     *
     * @param parent parent element (typically a Defs)
     * @param id filter ID, default 'sepia'
     * @return configured Filter
     */
    static Filter sepia(AbstractElementContainer parent, String id = 'sepia') {
<span class="nc" id="L175">        Filter filter = parent.addFilter(id)</span>
        // Sepia tone matrix: warm brown tones
<span class="nc" id="L177">        filter.addFeColorMatrix()</span>
            .type('matrix')
<span class="nc" id="L179">            .values('0.393 0.769 0.189 0 0 ' +</span>
                    '0.349 0.686 0.168 0 0 ' +
                    '0.272 0.534 0.131 0 0 ' +
                    '0 0 0 1 0')
<span class="nc" id="L183">        filter</span>
    }

    /**
     * Creates a brightness adjustment filter.
     * &lt;p&gt;
     * Makes the element lighter or darker.
     * &lt;p&gt;
     * Options:
     * &lt;ul&gt;
     *   &lt;li&gt;id - Filter ID (default: 'brightness')&lt;/li&gt;
     *   &lt;li&gt;amount - Brightness adjustment, 0 = black, 1 = normal, &gt;1 = brighter (default: 1.5)&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param parent parent element (typically a Defs)
     * @param options optional configuration map
     * @return configured Filter
     */
    static Filter brightness(AbstractElementContainer parent, Map options = [:]) {
<span class="nc bnc" id="L202" title="All 2 branches missed.">        String id = options.id ?: 'brightness'</span>
<span class="nc bnc" id="L203" title="All 4 branches missed.">        Number amountNum = options.amount != null ? options.amount as Number : 1.5</span>
<span class="nc" id="L204">        double amount = amountNum.doubleValue()</span>

<span class="nc" id="L206">        Filter filter = parent.addFilter(id)</span>
<span class="nc" id="L207">        FeComponentTransfer transfer = filter.addFeComponentTransfer()</span>
<span class="nc" id="L208">        transfer.addFeFuncR().type('linear').slope(amount)</span>
<span class="nc" id="L209">        transfer.addFeFuncG().type('linear').slope(amount)</span>
<span class="nc" id="L210">        transfer.addFeFuncB().type('linear').slope(amount)</span>

<span class="nc" id="L212">        filter</span>
    }

    /**
     * Creates a contrast adjustment filter.
     * &lt;p&gt;
     * Increases or decreases contrast.
     * &lt;p&gt;
     * Options:
     * &lt;ul&gt;
     *   &lt;li&gt;id - Filter ID (default: 'contrast')&lt;/li&gt;
     *   &lt;li&gt;amount - Contrast multiplier, &lt;1 = less contrast, &gt;1 = more contrast (default: 1.5)&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param parent parent element (typically a Defs)
     * @param options optional configuration map
     * @return configured Filter
     */
    static Filter contrast(AbstractElementContainer parent, Map options = [:]) {
<span class="nc bnc" id="L231" title="All 2 branches missed.">        String id = options.id ?: 'contrast'</span>
<span class="nc bnc" id="L232" title="All 4 branches missed.">        Number amountNum = options.amount != null ? options.amount as Number : 1.5</span>
<span class="nc" id="L233">        double amount = amountNum.doubleValue()</span>
<span class="nc" id="L234">        double intercept = -(0.5 * amount) + 0.5</span>

<span class="nc" id="L236">        Filter filter = parent.addFilter(id)</span>
<span class="nc" id="L237">        FeComponentTransfer transfer = filter.addFeComponentTransfer()</span>
<span class="nc" id="L238">        transfer.addFeFuncR().type('linear').slope(amount).intercept(intercept)</span>
<span class="nc" id="L239">        transfer.addFeFuncG().type('linear').slope(amount).intercept(intercept)</span>
<span class="nc" id="L240">        transfer.addFeFuncB().type('linear').slope(amount).intercept(intercept)</span>

<span class="nc" id="L242">        filter</span>
    }

    /**
     * Applies a filter to an element by setting its filter attribute.
     * &lt;p&gt;
     * Convenience method to apply a filter reference to any SVG element.
     *
     * @param element the element to apply the filter to
     * @param filterId the ID of the filter (without 'url(#)' wrapper)
     * @return the element for method chaining
     */
    static &lt;T extends SvgElement&lt;T&gt;&gt; T applyFilter(T element, String filterId) {
<span class="nc" id="L255">        element.filter(&quot;url(#${filterId})&quot;)</span>
<span class="nc" id="L256">        element</span>
    }

    /**
     * Applies a filter to an element by setting its filter attribute.
     * &lt;p&gt;
     * Convenience method that accepts a Filter object and extracts its ID.
     *
     * @param element the element to apply the filter to
     * @param filter the Filter to apply
     * @return the element for method chaining
     */
    static &lt;T extends SvgElement&lt;T&gt;&gt; T applyFilter(T element, Filter filter) {
<span class="nc" id="L269">        element.filter(&quot;url(#${filter.getId()})&quot;)</span>
<span class="nc" id="L270">        element</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>